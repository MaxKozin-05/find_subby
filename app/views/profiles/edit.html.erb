<!-- app/views/profiles/edit.html.erb -->
<% if @setup_mode %>
  <!-- Simple Onboarding Form (when URL has ?setup=true) -->
  <div class="mx-auto max-w-2xl p-4">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-900">Welcome to FindSubby!</h1>
      <p class="mt-4 text-lg text-gray-600">Let's set up your profile so clients can find you</p>
    </div>

    <div class="bg-white rounded-xl shadow-lg p-8">
      <%= form_with model: @profile, url: profile_path, method: :patch,
          local: true, multipart: true,
          html: { "data-turbo" => "false" } do |form| %>

        <%= hidden_field_tag :setup, 'true' %>

        <div class="mb-6">
          <%= form.label :business_name, "What's your business name?",
              class: 'block text-lg font-medium text-gray-900 mb-2' %>
          <%= form.text_field :business_name,
              class: 'w-full text-lg p-4 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500',
              placeholder: 'Smith Carpentry, ABC Plumbing, etc.' %>
        </div>

        <div class="mb-6">
          <%= form.label :trade_type, "What type of work do you do?",
              class: 'block text-lg font-medium text-gray-900 mb-2' %>
          <%= form.select :trade_type,
              options_for_select([
                ['Select your trade', ''],
                ['Carpenter', 'Carpenter'],
                ['Electrician', 'Electrician'],
                ['Plumber', 'Plumber'],
                ['Painter', 'Painter'],
                ['Tiler', 'Tiler'],
                ['Other', 'Other']
              ], @profile.trade_type),
              { include_blank: false },
              { class: 'w-full text-lg p-4 border-2 border-gray-300 rounded-lg bg-white' } %>
        </div>

        <div class="mb-6">
          <%= form.label :handle, "Choose your profile URL",
              class: 'block text-lg font-medium text-gray-900 mb-2' %>
          <%= form.text_field :handle,
              class: 'w-full text-lg p-4 border-2 border-gray-300 rounded-lg',
              placeholder: 'your-name' %>
        </div>

        <div class="space-y-4">
          <%= form.submit 'Create My Profile',
              class: 'w-full bg-blue-600 hover:bg-blue-700 text-white text-xl font-semibold py-4 px-6 rounded-lg border-0' %>

          <% if @profile.handle.present? %>
            <%= link_to 'Preview Live Profile', public_profile_path(@profile.handle),
                target: '_blank',
                class: 'w-full bg-gray-600 hover:bg-gray-700 text-white text-xl font-semibold py-4 px-6 rounded-lg border-0 text-center block' %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

<% else %>
  <!-- Full Profile Edit Form (normal editing) -->
  <div class="max-w-5xl mx-auto px-4 py-8">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-semibold">Edit Profile</h1>
      <%= link_to "Back to Profile", profile_path, class: "px-4 py-2 border rounded hover:bg-gray-50" %>
    </div>

    <%= form_with model: @profile, url: profile_path, method: :patch,
                  local: true, multipart: true,
                  html: { "data-turbo" => "false" } do |f| %>

      <!-- Basics -->
      <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-lg font-semibold mb-4">Basic Information</h2>

        <div class="grid gap-6 md:grid-cols-2">
          <div>
            <%= f.label :business_name, class: "block text-sm font-medium mb-2" %>
            <%= f.text_field :business_name, class: "w-full p-3 border rounded-lg" %>
          </div>

          <div>
            <%= f.label :trade_type, class: "block text-sm font-medium mb-2" %>
            <%= f.text_field :trade_type, class: "w-full p-3 border rounded-lg" %>
          </div>

          <div>
            <%= f.label :handle, "Profile URL", class: "block text-sm font-medium mb-2" %>
            <%= f.text_field :handle, class: "w-full p-3 border rounded-lg" %>
          </div>

          <div>
            <%= label_tag :"profile[service_area_text]", "Service Areas", class: "block text-sm font-medium mb-2" %>
            <%= text_field_tag :"profile[service_area_text]",
                               @profile.service_areas.join(", "),
                               class: "w-full p-3 border rounded-lg" %>
          </div>
        </div>

        <div class="mt-6">
          <%= f.label :about, class: "block text-sm font-medium mb-2" %>
          <%= f.text_area :about, rows: 4, class: "w-full p-3 border rounded-lg" %>
        </div>
      </div>

      <!-- Logo -->
      <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-lg font-semibold mb-4">Logo</h2>
        <%= f.file_field :logo, accept: "image/*", class: "block w-full" %>
        <% if @profile.logo.attached? %>
          <div class="mt-4">
            <%= image_tag @profile.logo.variant(resize_to_fill: [100,100]), class: "w-20 h-20 object-cover rounded" %>
          </div>
        <% end %>
      </div>

      <!-- Submit -->
      <div class="flex gap-3">
        <%= f.submit "Save Profile", class: "bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700" %>
        <% if @profile.handle.present? %>
          <%= link_to "Preview Live Profile", public_profile_path(@profile.handle),
              target: '_blank',
              class: "bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700" %>
        <% end %>
        <%= link_to "Cancel", profile_path, class: "border px-6 py-3 rounded hover:bg-gray-50" %>
      </div>
    <% end %>
  </div>
<% end %>
